<h2 class="title">{{ 'MANGA-LIST.TITLE' | translate }}</h2>

<button class="btn btn--ghost" (click)="openAddForm()">{{ 'MANGA-LIST.ADD-MANGA' | translate }}</button>

<div *ngIf="showAddForm" class="panel panel--form">
  <div class="panel__header">
    <h3 class="panel__title">
      {{ (isEditing ? 'MANGA-LIST.EDIT-MANGA' : 'MANGA-LIST.ADD-MANGA-FORM') | translate }}
    </h3>
    <button type="button" class="panel__close" (click)="cancelAdd()">Ã—</button>
  </div>

  <form class="form" (ngSubmit)="isEditing ? updateManga() : createManga()">
    <label class="form__field">
      <span class="form__label">{{ 'MANGA-LIST.FIELD-TITLE' | translate }}</span>
      <input class="form__input" [(ngModel)]="newManga.title" name="title" required />
    </label>

    <label class="form__field">
      <span class="form__label">{{ 'MANGA-LIST.FIELD-AUTHOR' | translate }}</span>
      <input class="form__input" [(ngModel)]="newManga.author" name="author" />
    </label>

    <label class="form__field">
      <span class="form__label">{{ 'MANGA-LIST.FIELD-TOTAL-VOLUMES' | translate }}</span>
      <input
        class="form__input"
        type="number"
        [(ngModel)]="newManga.totalVolumes"
        name="totalVolumes"
        min="1"
      />
    </label>

    <label class="form__field">
      <span class="form__label">{{ 'MANGA-LIST.FIELD-COVER-URL' | translate }}</span>
      <input class="form__input" [(ngModel)]="newManga.coverUrl" name="coverUrl" />
    </label>

    <div class="form__actions">
      <button type="submit" class="btn btn--primary">{{ 'COMMON.SAVE' | translate }}</button>
      <button type="button" class="btn btn--ghost" (click)="cancelAdd()">{{ 'COMMON.CANCEL' | translate }}</button>
    </div>
  </form>
</div>

<label class="search">
  <input
    class="search__input"
    type="text"
    [placeholder]="'MANGA-LIST.SEARCH-PLACEHOLDER' | translate"
    [(ngModel)]="query"
    (ngModelChange)="onQueryChange($event)"
    aria-label="Search manga"
  />
  <button
    *ngIf="query"
    type="button"
    class="search__clear"
    (click)="query = ''; onQueryChange('')"
    aria-label="Clear search"
  >
    Ã—
  </button>
</label>

<div *ngIf="isLoading" class="muted">{{ 'COMMON.LOADING' | translate }}</div>
<div *ngIf="!isLoading && mangas.length === 0" class="muted">{{ 'MANGA-LIST.NO-MANGA-FOUND' | translate }}</div>

<div *ngIf="!isLoading && mangas.length > 0" class="panel">
  <ul class="mlist">
    <li *ngFor="let m of mangas; trackBy: trackById" class="mlist__row">
      <a [routerLink]="['/manga', m.id]" class="mlist__link">
        <img
          class="mlist__cover"
          [src]="m.coverUrl || 'manga-placeholder.svg'"
          [alt]="m.title"
          (error)="onImgError($event)"
        />
        <div class="mlist__meta">
          <div class="mlist__title">{{ m.title }}</div>
          <div class="mlist__author">{{ m.author }}</div>
        </div>
      </a>

      <div class="mlist__actions">
        <button
          type="button"
          class="mlist__menu-toggle"
          (click)="toggleMenu(m.id, $event)"
          aria-label="Open actions menu"
        >
          &#8942;
        </button>

        <div class="mlist__menu" *ngIf="openMenuId === m.id">
          <button type="button" class="mlist__menu-item" (click)="onEdit(m, $event)">
            <span class="mlist__menu-icon">âœŽ</span>
            <span class="mlist__menu-label">{{ 'COMMON.EDIT' | translate }}</span>
          </button>

          <button
            type="button"
            class="mlist__menu-item mlist__menu-item--danger"
            (click)="openDeleteModal(m, $event)"
          >
            <span class="mlist__menu-icon">ðŸ—‘</span>
            <span class="mlist__menu-label">{{ 'COMMON.DELETE' | translate }}</span>
          </button>
        </div>
      </div>
    </li>
  </ul>
</div>
<div class="modal-backdrop" *ngIf="deleteConfirmVisible" (click)="closeDeleteModal()"></div>

<div class="modal" *ngIf="deleteConfirmVisible" (click)="closeDeleteModal()">
  <div class="modal__content" (click)="$event.stopPropagation()">
    <div class="modal__header">
      <h3 class="modal__title">{{ 'MANGA-LIST.DELETE-MANGA' | translate }}</h3>
    </div>

    <div class="modal__body">
      <p>
        {{ 'MANGA-LIST.DELETE-CONFIRM' | translate }}
        <strong>{{ mangaToDelete?.title }}</strong
        >?
      </p>
    </div>

    <div class="modal__footer">
      <button type="button" class="btn btn--ghost" (click)="closeDeleteModal()">{{ 'COMMON.CANCEL' | translate }}</button>
      <button type="button" class="btn btn--danger" (click)="confirmDelete()">{{ 'COMMON.DELETE' | translate }}</button>
    </div>
  </div>
</div>
