<h2 class="title">Manga List</h2>

<button class="btn btn--ghost" (click)="openAddForm()">+ Add Manga</button>

<div *ngIf="showAddForm" class="panel panel--form">
  <div class="panel__header">
    <h3 class="panel__title">Add Manga</h3>
    <button type="button" class="panel__close" (click)="cancelAdd()">×</button>
  </div>

  <form class="form" (ngSubmit)="createManga()">
    <label class="form__field">
      <span class="form__label">Title</span>
      <input class="form__input" [(ngModel)]="newManga.title" name="title" required />
    </label>

    <label class="form__field">
      <span class="form__label">Author</span>
      <input class="form__input" [(ngModel)]="newManga.author" name="author" />
    </label>

    <label class="form__field">
      <span class="form__label">Total Volumes</span>
      <input
        class="form__input"
        type="number"
        [(ngModel)]="newManga.totalVolumes"
        name="totalVolumes"
        min="1"
      />
    </label>

    <label class="form__field">
      <span class="form__label">Cover URL</span>
      <input class="form__input" [(ngModel)]="newManga.coverUrl" name="coverUrl" />
    </label>

    <div class="form__actions">
      <button type="submit" class="btn btn--primary">Save</button>
      <button type="button" class="btn btn--ghost" (click)="cancelAdd()">Cancel</button>
    </div>
  </form>
</div>

<label class="search">
  <input
    class="search__input"
    type="text"
    placeholder="Search by title…"
    [(ngModel)]="query"
    (ngModelChange)="onQueryChange($event)"
    aria-label="Search manga"
  />
  <button
    *ngIf="query"
    type="button"
    class="search__clear"
    (click)="query = ''; onQueryChange('')"
    aria-label="Clear search"
  >
    ×
  </button>
</label>

<div *ngIf="isLoading" class="muted">Loading…</div>
<div *ngIf="!isLoading && mangas.length === 0" class="muted">No manga found.</div>

<div *ngIf="!isLoading && mangas.length > 0" class="panel">
  <ul class="mlist">
    <li *ngFor="let m of mangas; trackBy: trackById" class="mlist__row">
      <a [routerLink]="['/manga', m.id]" class="mlist__link">
        <img
          class="mlist__cover"
          [src]="m.coverUrl || 'manga-placeholder.svg'"
          [alt]="m.title"
          (error)="onImgError($event)"
        />
        <div class="mlist__meta">
          <div class="mlist__title">{{ m.title }}</div>
          <div class="mlist__author">{{ m.author }}</div>
        </div>
      </a>
    </li>
  </ul>
</div>
